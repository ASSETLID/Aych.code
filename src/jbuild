(* -*- tuareg -*- *)
#require "unix"

let version =
  let ic = open_in "../VERSION" in
  let version = input_line ic in
  close_in ic;
  version

let () = Printf.ksprintf Jbuild_plugin.V1.send {|
(jbuild_version 1)

(rule
 ((targets (indentVersion.ml))
  (deps ())
  (action (with-stdout-to ${@}
  (echo "let version = \"%s\"")))))

(ocamllex (approx_lexer))

(library
 ((name ocp_indent_lexer)
  (public_name ocp-indent.lexer)
  (wrapped false)
  (modules (indentExtend approx_tokens approx_lexer))))

(library
 ((name ocp_indent_lib)
  (wrapped false)
  (public_name ocp-indent.lib)
  (libraries (ocp-indent.utils))
  (modules (indentConfig indentBlock indentPrinter))))

(library
 ((name ocp_indent_utils)
  (public_name ocp-indent.utils)
  (wrapped false)
  (libraries (bytes ocp-indent.lexer))
  (modules (compat pos util nstream))))

(library
 ((name ocp_indent_dynlink)
  (public_name ocp-indent.dynlink)
  (wrapped false)
  (modules (indentLoader))
  (libraries (findlib dynlink ocp-indent.lexer ocp-indent.utils))))

(executable
 ((name indentMain)
  (public_name ocp-indent)
  (modules (indentVersion indentArgs indentMain))
  (libraries (cmdliner ocp-indent.lexer ocp-indent.lib ocp-indent.dynlink))))
|} version
